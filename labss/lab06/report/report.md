---
## Front matter
title: "Отчёт по лабораторной работе №6"
subtitle: "Адресация IPv4 и IPv6. Двойной стек"
author: "Владимир Базлов"

## Generic otions
lang: ru-RU
toc-title: "Содержание"

## Bibliography
bibliography: bib/cite.bib
csl: pandoc/csl/gost-r-7-0-5-2008-numeric.csl

## Pdf output format
toc: true
toc-depth: 2
lof: true
lot: true
fontsize: 12pt
linestretch: 1.5
papersize: a4
documentclass: scrreprt
## I18n polyglossia
polyglossia-lang:
  name: russian
  options:
    - spelling=modern
    - babelshorthands=true
polyglossia-otherlangs:
  name: english
## I18n babel
babel-lang: russian
babel-otherlangs: english
## Fonts
mainfont: IBM Plex Serif
romanfont: IBM Plex Serif
sansfont: IBM Plex Sans
monofont: IBM Plex Mono
mathfont: STIX Two Math
mainfontoptions: Ligatures=Common,Ligatures=TeX,Scale=0.94
romanfontoptions: Ligatures=Common,Ligatures=TeX,Scale=0.94
sansfontoptions: Ligatures=Common,Ligatures=TeX,Scale=MatchLowercase,Scale=0.94
monofontoptions: Scale=MatchLowercase,Scale=0.94,FakeStretch=0.9
mathfontoptions:
## Biblatex
biblatex: true
biblio-style: "gost-numeric"
biblatexoptions:
  - parentracker=true
  - backend=biber
  - hyperref=auto
  - language=auto
  - autolang=other*
  - citestyle=gost-numeric
## Pandoc-crossref LaTeX customization
figureTitle: "Рис."
tableTitle: "Таблица"
listingTitle: "Листинг"
lofTitle: "Список иллюстраций"
lotTitle: "Список таблиц"
lolTitle: "Листинги"
## Misc options
indent: true
header-includes:
  - \usepackage{indentfirst}
  - \usepackage{float}
  - \floatplacement{figure}{H}
---

# Цель работы

Изучение принципов распределения и настройки адресного пространства на устройствах сети.

# Разбиение подсетей

## Задача 1. Разбиение сети 172.16.20.0/24

Исходная сеть:
- Префикс: /24  
- Маска: 255.255.255.0  
- Адрес сети: 172.16.20.0  
- Broadcast-адрес: 172.16.20.255  
- Общее число адресов: 256  
- Число адресов узлов: 254 (с 172.16.20.1 по 172.16.20.254)

Требуется разбить сеть на 3 подсети с количеством адресов узлов:
- 126 узлов
- 62 узла
- 62 узла

Используем VLSM: сначала выделяем самую крупную подсеть.

1) Подсеть на 126 узлов  
Нужно как минимум 128 адресов ⇒ префикс /25.  
Получаем подсеть:

- Сеть: 172.16.20.0/25  
- Маска: 255.255.255.128  
- Адрес сети: 172.16.20.0  
- Broadcast-адрес: 172.16.20.127  
- Диапазон адресов узлов: 172.16.20.1 – 172.16.20.126  
- Число адресов узлов: 126  

2) Подсеть на 62 узла (№1)  
Оставшаяся часть исходной сети — 172.16.20.128/25.  
Для 62 узлов нужны 64 адреса ⇒ префикс /26.  
Первая половина второго /25:

- Сеть: 172.16.20.128/26  
- Маска: 255.255.255.192  
- Адрес сети: 172.16.20.128  
- Broadcast-адрес: 172.16.20.191  
- Диапазон адресов узлов: 172.16.20.129 – 172.16.20.190  
- Число адресов узлов: 62  

3) Подсеть на 62 узла (№2)  
Вторая половина диапазона 172.16.20.128/25:

- Сеть: 172.16.20.192/26  
- Маска: 255.255.255.192  
- Адрес сети: 172.16.20.192  
- Broadcast-адрес: 172.16.20.255  
- Диапазон адресов узлов: 172.16.20.193 – 172.16.20.254  
- Число адресов узлов: 62  

## Задача 2. Сеть 10.10.1.64/26 и подсеть на 30 узлов

Исходная сеть:
- Префикс: /26  
- Маска: 255.255.255.192  
- Адрес сети: 10.10.1.64  
- Broadcast-адрес: 10.10.1.127  
- Общее число адресов: 64  
- Число адресов узлов: 62 (10.10.1.65 – 10.10.1.126)

Требуется выделить подсеть на 30 узлов.  
Для 30 узлов нужны 32 адреса ⇒ префикс /27.

Сеть 10.10.1.64/26 делится на две подсети /27:
- 10.10.1.64/27 (адреса 64–95)
- 10.10.1.96/27 (адреса 96–127)

Выделим первую подсеть:

Характеристики подсети на 30 узлов:
- Сеть: 10.10.1.64/27  
- Маска: 255.255.255.224  
- Адрес сети: 10.10.1.64  
- Broadcast-адрес: 10.10.1.95  
- Диапазон адресов узлов: 10.10.1.65 – 10.10.1.94  
- Число адресов узлов: 30  

## Задача 3. Сеть 10.10.1.0/26 и подсеть на 14 узлов

Исходная сеть:
- Префикс: /26  
- Маска: 255.255.255.192  
- Адрес сети: 10.10.1.0  
- Broadcast-адрес: 10.10.1.63  
- Общее число адресов: 64  
- Диапазон адресов узлов: 10.10.1.1 – 10.10.1.62  
- Число адресов узлов: 62  

Нужно выделить подсеть на 14 узлов.  
Для 14 узлов необходимо 16 адресов ⇒ префикс /28.

Сеть 10.10.1.0/26 разбивается на четыре подсети /28:
- 10.10.1.0/28   (0–15)
- 10.10.1.16/28  (16–31)
- 10.10.1.32/28  (32–47)
- 10.10.1.48/28  (48–63)

Выделим первую подсеть:

Характеристики подсети на 14 узлов:
- Сеть: 10.10.1.0/28  
- Маска: 255.255.255.240  
- Адрес сети: 10.10.1.0  
- Broadcast-адрес: 10.10.1.15  
- Диапазон адресов узлов: 10.10.1.1 – 10.10.1.14  
- Число адресов узлов: 14  

## Задача 4 Разбиение сети 2001:db8:c0de::/48

### Характеристики исходной сети
- Адрес: 2001:db8:c0de::  
- Префикс: /48  
- Маска: ffff:ffff:ffff:0000:0000:0000:0000:0000  
- Диапазон адресов узлов:
  - минимальный: 2001:db8:c0de:0:0:0:0:0  
  - максимальный: 2001:db8:c0de:ffff:ffff:ffff:ffff  

Сеть /48 обычно содержит **поле Subnet ID (16 бит)** и **Interface ID (64 бит)**.

### Вариант А. Разбиение по идентификатору подсети (Subnet ID)
Используется 4-й гексет.

1) Подсеть 2001:db8:c0de:1::/64  
- диапазон: 2001:db8:c0de:1:0:0:0:0 – 2001:db8:c0de:1:ffff:ffff:ffff:ffff  

2) Подсеть 2001:db8:c0de:2::/64  
- диапазон: 2001:db8:c0de:2:0:0:0:0 – 2001:db8:c0de:2:ffff:ffff:ffff:ffff  

### Вариант Б. Разбиение по идентификатору интерфейса (Interface ID)
Используем старший бит Interface ID ⇒ создаём две подсети /65.

1) Подсеть 2001:db8:c0de:0::/65  
- диапазон: 2001:db8:c0de:0:0:0:0:0 – 2001:db8:c0de:0:7fff:ffff:ffff:ffff  

2) Подсеть 2001:db8:c0de:0:8000::/65  
- диапазон: 2001:db8:c0de:0:8000:0:0:0 – 2001:db8:c0de:0:ffff:ffff:ffff:ffff  

## Задача 5 Разбиение сети 2a02:6b8::/64

### Характеристики исходной сети
- Адрес: 2a02:6b8::  
- Префикс: /64  
- Маска: ffff:ffff:ffff:ffff:0000:0000:0000:0000  
- Диапазон адресов узлов:
  - минимальный: 2a02:6b8:0:0:0:0:0:0  
  - максимальный: 2a02:6b8:0:0:ffff:ffff:ffff:ffff  

В сети /64 уже нет отдельного Subnet ID, всё поле ниже — Interface ID.

### Вариант А. Разбиение «логическим Subnet ID» внутри Interface ID
Забираем 1 бит из Interface ID ⇒ получаем две подсети /65.

1) Подсеть 2a02:6b8::/65  
- диапазон: 2a02:6b8:0:0:0:0:0:0 – 2a02:6b8:0:0:7fff:ffff:ffff:ffff  

2) Подсеть 2a02:6b8:0:0:8000::/65  
- диапазон: 2a02:6b8:0:0:8000:0:0:0 – 2a02:6b8:0:0:ffff:ffff:ffff:ffff  

### Вариант Б. Разбиение по диапазонам Interface ID без изменения префикса
Префикс /64 остаётся, но адресное пространство логически разделяется.

1) Диапазон 1:
- 2a02:6b8:: – 2a02:6b8:0:0:0:0:7fff:ffff  

2) Диапазон 2:
- 2a02:6b8:0:0:8000:: – 2a02:6b8:0:0:ffff:ffff:ffff:ffff  

# Выполнение задний

## Настройка IPv4-адресации и проверка связности в топологии GNS3

В GNS3 создан новый проект, после чего на рабочем поле размещены устройства и соединены согласно заданной топологии.

![Топология сети](Screenshot_1.png){ #fig:001 width=80% }

Устройствам присвоены имена в соответствии с правилами: коммутаторы msk-vabazlov-sw-0x, ПК PCx-vabazlov, маршрутизатор msk-vabazlov-net-gw-01.

## Настройка IPv4-адресов на PC1, PC2 и сервере

На PC1-vabazlov назначены адрес 172.16.20.10/25 и шлюз 172.16.20.1.  
Проверка через show ip и show ipv6 подтверждает корректность конфигурации.

![Настройка PC1](Screenshot_2.png){ #fig:002 width=80% }

На PC2-vabazlov назначены адрес 172.16.20.138/25 и шлюз 172.16.20.129.  
Вывод команд отображает корректную информацию IPv4 и IPv6.

![Настройка PC2](Screenshot_3.png){ #fig:003 width=80% }

На сервере назначения выполнены для адреса 64.100.1.10/24 и шлюза 64.100.1.1.  
Конфигурация проверена командами show ip и show ipv6.

![Настройка сервера](Screenshot_4.png){ #fig:004 width=80% }

## Настройка маршрутизатора FRR msk-vabazlov-net-gw-01

Маршрутизатору присвоено имя msk-vabazlov-net-gw-01.  
Интерфейсы eth0, eth1 и eth2 настроены на соответствующие IPv4-подсети, используемые в топологии.

![Конфигурация интерфейсов FRR](Screenshot_5.png){ #fig:005 width=80% }

## Проверка конфигурации маршрутизатора

Вывод текущей конфигурации показывает корректное применение настроек.  
Информация об интерфейсах демонстрирует активные порты и назначенные адреса.

![show running-config](Screenshot_6.png){ #fig:006 width=80% }

![show interface brief](Screenshot_7.png){ #fig:007 width=80% }

## Проверка сетевой связности

С сервера выполнены проверки доступности PC1 и PC2 посредством ping и trace.  
Оба узла успешно отвечают, а пути прохождения пакетов проходят через маршрутизатор.

![Проверка ping и trace](Screenshot_8.png){ #fig:008 width=80% }

Связность между всеми узлами подтверждена, IPv4-адресация функционирует корректно.

## Настройка IPv6-адресации узлов PC3, PC4 и сервера

На PC3-vabazlov назначен глобальный IPv6-адрес 2001:db8:c0de:12::a/64.  
Команды show ip и show ipv6 подтверждают наличие линк-локального и глобального адресов.

![PC3 IPv6](Screenshot_9.png){ #fig:009 width=80% }

На PC4-vabazlov назначен адрес 2001:db8:c0de:13::a/64.  
Вывод конфигурации корректен.

![PC4 IPv6](Screenshot_10.png){ #fig:010 width=80% }

На сервере настроен адрес 2001:db8:c0de:11::a/64.  
Его вывод show ipv6 демонстрирует корректную настройку двойного стека IPv4/IPv6.

![Server IPv6](Screenshot_11.png){ #fig:011 width=80% }

## Настройка IPv6-адресации на маршрутизаторе VyOS msk-vabazlov-gw-02

Маршрутизатор установлен и перезагружен, затем ему присвоено имя msk-vabazlov-gw-02.  
На интерфейсы eth0, eth1 и eth2 назначены IPv6-адреса и включены Router Advertisements для автоматической раздачи префиксов узлам.

![VyOS IPv6 config](Screenshot_12.png){ #fig:012 width=80% }

## Проверка связности между узлами IPv6

PC3 успешно отправляет эхо-запросы на PC4 и сервер, что подтверждает корректную маршрутизацию внутри IPv6-подсетей.

![PC3 ping IPv6](Screenshot_13.png){ #fig:013 width=80% }

Сервер с двойным стеком доступен как по IPv6, так и по IPv4.  
Проверка показывает успешные ICMPv6-ответы и доступность IPv4-хоста 172.16.20.138.

![Server pings IPv6 and IPv4](Screenshot_14.png){ #fig:014 width=80% }

## Разделение подсетей IPv4 и IPv6

Устройства, находящиеся только в подсети IPv6, не могут обращаться к узлам IPv4, так как у них отсутствует IPv4-стек.  
Аналогично, узлы исключительно IPv4 не могут обратиться к адресам формата IPv6.  
Связность между двумя доменами обеспечивает только сервер двойного стека, имеющий обе адресации.

## Анализ перехваченного трафика ARP, ICMP и ICMPv6

На соединении между сервером двойного стека и коммутатором выполнен захват трафика. В полученных данных отображаются:

### ARP
ARP-запросы отражают работу IPv4-подсети:
- запросы вида «Who has 64.100.1.1? Tell 64.100.1.10» показывают, что сервер определяет MAC-адрес шлюза;
- ответы от маршрутизатора содержат его MAC-адрес.

![ARP traffic](Screenshot_15.png){ #fig:015 width=80% }

### ICMPv4
Видны ICMP Echo Request и Echo Reply между сервером и узлами IPv4.  
Пакеты содержат:
- идентификатор,
- номер последовательности,
- TTL и контрольные суммы.

![ICMP IPv4](Screenshot_16.png){ #fig:016 width=80% }

### ICMPv6
В трафике присутствуют:
- Neighbor Solicitation и Neighbor Advertisement (аналог ARP для IPv6),
- ICMPv6 Echo Request / Reply между сервером и PC3/PC4.

Пакеты ICMPv6 позволяют видеть hop-limit, идентификатор и ответный кадр.

![ICMPv6](Screenshot_17.png){ #fig:017 width=80% }

# Выполнение самостоятельного задания

## Характеристика подсетей

Для заданной топологии используются две подсети IPv4 и две подсети IPv6.

Подсеть 1 (для PC1 и интерфейса eth0 маршрутизатора):
- IPv4-префикс: 10.10.1.96/27
- Маска: 255.255.255.224
- Количество адресов: 32 (30 доступных для узлов)
- Адрес сети: 10.10.1.96
- Широковещательный адрес: 10.10.1.127
- Диапазон адресов узлов: 10.10.1.97–10.10.1.126

Подсеть 2 (для PC2 и интерфейса eth1 маршрутизатора):
- IPv4-префикс: 10.10.1.16/28
- Маска: 255.255.255.240
- Количество адресов: 16 (14 доступных для узлов)
- Адрес сети: 10.10.1.16
- Широковещательный адрес: 10.10.1.31
- Диапазон адресов узлов: 10.10.1.17–10.10.1.30

Подсети IPv6:
- Подсеть 1: префикс 2001:db8:1:1::/64  
  Диапазон адресов узлов: от 2001:db8:1:1:: до 2001:db8:1:1:ffff:ffff:ffff:ffff  
  Используемые адреса: 2001:db8:1:1::1 (маршрутизатор), 2001:db8:1:1::a (PC1).
- Подсеть 2: префикс 2001:db8:1:4::/64  
  Диапазон адресов узлов: от 2001:db8:1:4:: до 2001:db8:1:4:ffff:ffff:ffff:ffff  
  Используемые адреса: 2001:db8:1:4::1 (маршрутизатор), 2001:db8:1:4::a (PC2).

Во всех подсетях интерфейсу маршрутизатора назначен наименьший доступный адрес (10.10.1.97 и 10.10.1.17 для IPv4, ::1 для IPv6).

## Таблица адресации

Топология сети:

![Топология сети](Screenshot_18.png){ #fig:018 width=80% }

Таблица адресации для устройств:

| Устройство              | Интерфейс | IPv4-адрес/маска     | Шлюз по умолчанию | IPv6-адрес/префикс          | Назначение                     |
|-------------------------|-----------|----------------------|-------------------|-----------------------------|--------------------------------|
| PC1-vabazlov            | VPCS      | 10.10.1.100/27       | 10.10.1.97        | 2001:db8:1:1::a/64          | Узел подсети 1                 |
| PC2-vabazlov            | VPCS      | 10.10.1.20/28        | 10.10.1.17        | 2001:db8:1:4::a/64          | Узел подсети 2                 |
| msk-vabazlov-gw-01      | eth0      | 10.10.1.97/27        | —                 | 2001:db8:1:1::1/64          | Шлюз для подсети 1             |
| msk-vabazlov-gw-01      | eth1      | 10.10.1.17/28        | —                 | 2001:db8:1:4::1/64          | Шлюз для подсети 2             |
| msk-vabazlov-sw-01, sw-02 | порты к PC и GW | без IP               | —                 | без IP                      | Коммутаторы уровня 2           |

## Настройка IP-адресации на оконечных устройствах

На PC1-vabazlov назначены:
- IPv4-адрес 10.10.1.100/27, шлюз 10.10.1.97;
- IPv6-адрес 2001:db8:1:1::a/64.

Проверка командами show ip и show ipv6 показывает корректное наличие IPv4- и IPv6-адресов, а также линк-локального IPv6-адреса.

![PC1 адресация](Screenshot_19.png){ #fig:019 width=80% }

На PC2-vabazlov назначены:
- IPv4-адрес 10.10.1.20/28, шлюз 10.10.1.17;
- IPv6-адрес 2001:db8:1:4::a/64.

Вывод show ip и show ipv6 подтверждает корректную конфигурацию.

![PC2 адресация, ввод настроек](Screenshot_20.png){ #fig:020 width=80% }

![PC2 адресация](Screenshot_21.png){ #fig:021 width=80% }

## Настройка маршрутизатора VyOS

На маршрутизаторе msk-vabazlov-gw-01 в режиме configure выполнены следующие действия:
- для интерфейса eth0 (подсеть 1) назначены адреса 10.10.1.97/27 и 2001:db8:1:1::1/64;
- для интерфейса eth1 (подсеть 2) назначены адреса 10.10.1.17/28 и 2001:db8:1:4::1/64;
- конфигурация сохранена в файл config.boot.

Вывод show interfaces демонстрирует назначенные IPv4- и IPv6-адреса на интерфейсах маршрутизатора.

![Интерфейсы маршрутизатора](Screenshot_22.png){ #fig:022 width=80% }

## Проверка подключений (ping и trace)

Для проверки связности из узла PC1 выполнена отправка эхо-запросов на PC2:
- ping 10.10.1.20 — успешные ответы подтверждают работоспособность IPv4-маршрутизации между подсетями через msk-vabazlov-gw-01;
- ping 2001:db8:1:4::a — успешные ICMPv6-ответы показывают корректную маршрутизацию IPv6.

![Проверка ping IPv4 и IPv6](Screenshot_23.png){ #fig:023 width=80% }

# Заключение

В ходе работы выполнен анализ IPv6-адресного пространства и выполнено разбиение сетей двумя различными способами — с использованием идентификатора подсети и с использованием идентификатора интерфейса. Показано, что сеть с префиксом /48 позволяет формировать классическую иерархию подсетей, изменяя Subnet ID, тогда как сеть /64 может быть разделена только за счёт структуры Interface ID. Оба подхода позволяют гибко организовывать адресное пространство и адаптировать его к различным требованиям — как для изоляции подсетей, так и для логического разделения устройств в пределах одного сетевого сегмента.
